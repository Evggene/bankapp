apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-transfer-config
  labels:
    app.kubernetes.io/name: transfer
    app.kubernetes.io/instance: {{ .Release.Name }}
data:
  application.yml: |-
    server:
      port: {{ .Values.service.port }}

    management:
      endpoints:
        web:
          exposure:
            include: health,info,env,refresh

    logging:
      level:
        org.springframework.web: INFO

    spring:
      datasource:
        url: jdbc:postgresql://{{- if .Values.database.host }}{{ .Values.database.host }}{{- else }}{{ .Release.Name }}-postgres{{- end }}:{{ .Values.database.port }}/{{ .Values.database.name }}
        username: {{ .Values.database.username | quote }}
        password: {{ .Values.database.password | quote }}

    keycloak:
      url: "http://{{- if .Values.keycloak.host }}{{ .Values.keycloak.host }}{{- else }}{{ .Release.Name }}-keycloak{{- end }}:{{ .Values.keycloak.port }}{{ .Values.keycloak.relativePath }}"

    # В библиотеке SharedAppProperties используется префикс 'shared'
    shared:
      gateway-base-url: "{{- if .Values.shared.gatewayBaseUrl }}{{ .Values.shared.gatewayBaseUrl }}{{- else }}http://bankapp.{{ .Values.global.minikubeIp }}.nip.io{{- end }}"
    # На случай если где-то в модуле осталась ссылка app.gateway-base-url
    app:
      gateway-base-url: "{{- if .Values.shared.gatewayBaseUrl }}{{ .Values.shared.gatewayBaseUrl }}{{- else }}http://bankapp.{{ .Values.global.minikubeIp }}.nip.io{{- end }}"
