apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-exchange-config
  labels:
    app.kubernetes.io/name: exchange
    app.kubernetes.io/instance: {{ .Release.Name }}
data:
  application.yml: |-
    server:
      port: {{ .Values.service.port }}
    spring:
      datasource:
        url: jdbc:postgresql://{{ include "accounts.postgresHost" . }}:{{ .Values.postgres.port }}/{{ .Values.postgres.database }}
        username: {{ .Values.postgres.username }}
        password: {{ .Values.postgres.password }}
      jpa:
        hibernate:
          ddl-auto: none
        show-sql: true
        properties:
          hibernate:
            format_sql: true
    management:
      endpoints:
        web:
          exposure:
            include: health,info,env,refresh

    logging:
      level:
        org.springframework.web: INFO

    # Keycloak base URL (with relative path) â€” used by SecurityConfig/JWT decoder
    keycloak:
      url: "http://{{- if .Values.keycloak.host }}{{ .Values.keycloak.host }}{{- else }}{{ .Release.Name }}-keycloak{{- end }}:{{ .Values.keycloak.port }}{{ .Values.keycloak.relativePath }}"

    # Internal dependency: exchange-generator
    generator:
      url: "http://{{- if .Values.generator.host }}{{ .Values.generator.host }}{{- else }}{{ .Release.Name }}-exchange-generator{{- end }}:{{ .Values.generator.port }}"

    # Optional: base URL for calls through ingress
    shared:
      gateway-base-url: "{{- if .Values.shared.gatewayBaseUrl }}{{ .Values.shared.gatewayBaseUrl }}{{- else }}http://bankapp.{{ .Values.global.minikubeIp }}.nip.io{{- end }}"
