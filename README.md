# BankApp

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –∞–∫–∫–∞—É–Ω—Ç—ã, –ø–µ—Ä–µ–≤–æ–¥—ã, –∫—ç—à, –æ–±–º–µ–Ω –≤–∞–ª—é—Ç, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, gateway –∏ UI.  
–ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–æ–≤–∞–Ω–æ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –≤ Kubernetes —á–µ—Ä–µ–∑ Helm umbrella-chart `bankapp-chart`.

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

- **Java 21+**
- **Maven 3.8+**
- **Docker / Docker Compose**
- **Minikube** (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Kubernetes)
- **Helm 3+**
- **kubectl**
- **Optional:** DBeaver / pgAdmin –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL

---

## üöÄ –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### üì¶ –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
```bash
mvn clean install
```

### ‚ò∏Ô∏è –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes —á–µ—Ä–µ–∑ Helm

```bash
helm dependency update bankapp-chart
helm upgrade --install bankapp .bankapp-chart -n bankapp --create-namespace -f .bankapp-chart/values.yaml -f .bankapp-chart/prometheus.values.yaml -f .bankapp-chart/grafana.values.yaml
```

---

## üß© –ú–æ–¥—É–ª–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã

| –°–µ—Ä–≤–∏—Å               | –ü–æ—Ä—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                  |
|-----------------------|------|----------------------------------------------|
| Accounts              | 8010 | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π   |
| Blocker               | 8020 | –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏             |
| Cash                  | 8030 | –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –Ω–∞–ª–∏—á–Ω—ã–º–∏                        |
| Exchange              | 8040 | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç                           |
| Exchange Generator    | 8050 | –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç                     |
| Notifications         | 8070 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∏ UI —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è          |
| Transfer              | 8090 | –î–µ–Ω–µ–∂–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã                           |
| Front-UI              | 8060 | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å                     |    
| PostgreSQL            | 5431 | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î                                 |
| Keycloak              | 8101 | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ç–æ–∫–µ–Ω—ã                        |
| Kafka                 | 9092 | –°–æ–æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏                  |
| Zipkin                | 9411 | –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤                       |
| Prometheus            | 9090 | –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫                                |
| Grafana               | 3000 | –î–∞—à–±–æ—Ä–¥—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è                    |
| OpenSearch            | 9200 | –•—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤                            |
| OpenSearch Dashboards | 5601 | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∏—Å–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤       |
| Logstash              | 5044 | –ü—Ä–∏—ë–º –ª–æ–≥–æ–≤ –æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤              |

---

## üì° Kafka ‚Äî —Ç–æ–ø–∏–∫–∏

| –¢–æ–ø–∏–∫                   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                | –ü—Ä–æ–¥—é—Å–µ—Ä               | –ö–æ–Ω—Å—å—é–º–µ—Ä—ã            |
|--------------------------|--------------------------------------------|-------------------------|-----------------------|
| `exchange.rates`        | –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç                   | exchange-generator     | exchange             |
| `notifications.events`  | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö          | transfer, cash         | notifications        |
| `bankapp-logs`         | –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ ‚Üí Logstash  | –≤—Å–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã      | Logstash ‚Üí OpenSearch |

---

## üî• Observability (–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å)

### üìä Prometheus + Grafana

- **Prometheus** —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (`/actuator/prometheus`), –≤–∫–ª—é—á–∞—è HTTP-–º–µ—Ç—Ä–∏–∫–∏, JVM, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—á—ë—Ç—á–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Å–ø–µ—à–Ω—ã–π/–Ω–µ—É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥).
- **Grafana** —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ Helm —Å–∞–±—á–∞—Ä—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º –¥–∞—à–±–æ—Ä–¥–æ–≤.  
  –í–∫–ª—é—á–µ–Ω—ã:
    - `BankApp - HTTP Service Overview` ‚Äî RPS, 4xx/5xx, –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Accounts (signup/login)
    - `BankApp - JVM Overview` ‚Äî –ø–∞–º—è—Ç—å, GC, CPU, –ø–æ—Ç–æ–∫–∏

URL: [http://grafana.192.168.49.2.nip.io](http://grafana.192.168.49.2.nip.io)

---

### üß† Zipkin

–í–∫–ª—é—á—ë–Ω –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ Spring Cloud Sleuth / Micrometer Tracing.

URL: [http://zipkin.192.168.49.2.nip.io/zipkin](http://zipkin.192.168.49.2.nip.io/zipkin)

---

### ü™µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: Logstash + OpenSearch + OpenSearch Dashboards

–ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –ª–æ–≥–æ–≤ –≤ Kafka —Ç–æ–ø–∏–∫ `bankapp-logs` —á–µ—Ä–µ–∑ Log4j2 Kafka Appender.  
–î–∞–ª–µ–µ:
1. Logstash —á–∏—Ç–∞–µ—Ç –∏–∑ —Ç–æ–ø–∏–∫–∞ `bankapp-logs`.
2. Logstash –ø–∞—Ä—Å–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ JSON –∏ –ø–∏—à–µ—Ç –≤ OpenSearch.
3. OpenSearch Dashboards –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ª–æ–≥–∏.

- Dashboards URL: [http://192.168.49.2.nip.io/dashboards]

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤

### –ú–µ—Ç—Ä–∏–∫–∏
```bash
kubectl port-forward svc/bankapp-prometheus-server 9090:80 -n bankapp
# http://localhost:9090
```

–ü—Ä–∏–º–µ—Ä—ã PromQL:
```promql
sum by (result) (rate(accounts_signup_total[5m]))
sum by (result) (rate(accounts_login_total[5m]))
```

---

## üßº –£–¥–∞–ª–µ–Ω–∏–µ

```bash
helm uninstall bankapp -n bankapp
kubectl delete ns bankapp
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π `values.yaml` —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ IP –∏ —Ç–µ–≥–æ–≤ –æ–±—Ä–∞–∑–æ–≤.
- nip.io –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç IP Minikube –≤ DNS-–∏–º—è, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Ingress.
- Grafana, Zipkin –∏ OpenSearch –º–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∞—Ç—å —á–µ—Ä–µ–∑ `values.yaml`, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã.
